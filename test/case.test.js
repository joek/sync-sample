var request = require('supertest')
  , app = require('../app');
var expect = require('expect.js');




let url;



describe('Test Case Wekhook', () => {
    it('Removes Processor on team change', (done) => {
        var testRequestBody = {"entity":"sap.crm.caseservice.entity.case","currentImage":{"id":"ef1168aa-7fce-11ee-b35c-c131ed2a6ffb","displayId":"47545","subject":"float","priority":"03","priorityDescription":"Medium","origin":"MANUAL_DATA_ENTRY","caseType":"ZINC","caseTypeDescription":"Case Type for Account","statusSchema":"01","status":"01","statusDescription":"open up","escalationStatus":"NOT_ESCALATED","communicationLanguage":"lt","isRecommendedCommunicationLanguage":false,"account":{"defaultExternalBusinessPartnerId":"1011051","id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","name":"0cb123e6-205c-490e-9ae6-656d1a836665","isDeleted":false,"partyRoleCategory":"ACCOUNT","partyRole":"1001","partyRoleDescription":"Account","determinationMethodCode":1,"isMain":true,"partyType":"ACCOUNT"},"contact":{"emailId":"cOrg_c6156eb0@modernized.sap.com","id":"11ed11d5-53f5-b5ee-afdb-81b512a8c000","displayId":"1003607","name":"42482196-6d3d-4a2b-94d9-d4d5031ee01d 912e6383-8ae6-49b7-94e1-0911dbe73b03","isDeleted":false,"partyRoleCategory":"ACCOUNT_CONTACT","partyRole":"591","partyRoleDescription":"Contact of Account","addressId":"11ed11d5-53f9-385e-afdb-81b512a8c000","determinationMethodCode":7,"isMain":true,"partyType":"CONTACT"},"processor":{"emailId":"user.usa@dummy.com","employeeDisplayId":"USERUSA1","id":"11ecc541-6e89-4fbe-afdb-81e430a8c000","displayId":"8000000119","name":"USER USA","isDeleted":false,"partyRoleCategory":"PROCESSOR","partyRole":"40","partyRoleDescription":"Processor","addressId":"11ede9a4-544b-20ae-afdb-81f452a8c000","determinationMethodCode":3,"isMain":true,"partyType":"EMPLOYEE"},"serviceTeam":{"id":"11ecafbb-3805-a33e-afdb-810231a8c000","displayId":"SO_KM99","name":"AA: do not touch!!","isDeleted":false,"partyRoleCategory":"SERVICE_TEAM","partyRole":"28","partyRoleDescription":"Service and Support Team","addressId":"11ec5c1e-611b-88ce-afdb-23454c534123","determinationMethodCode":1,"isMain":true,"partyType":"ORGANIZATIONAL_UNIT"},"reporter":{"id":"11ed11d5-53f5-b5ee-afdb-81b512a8c000","displayId":"1003607","name":"42482196-6d3d-4a2b-94d9-d4d5031ee01d 912e6383-8ae6-49b7-94e1-0911dbe73b03","isDeleted":false,"partyRoleCategory":"REPORTER","partyRole":"214","partyRoleDescription":"Reporter","addressId":"11ed11d5-53f9-385e-afdb-81b512a8c000","determinationMethodCode":5,"isMain":true,"partyType":"CONTACT"},"billToAccount":{"defaultExternalBusinessPartnerId":"1011051","id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","name":"0cb123e6-205c-490e-9ae6-656d1a836665","isDeleted":false,"partyRoleCategory":"BILL_TO","partyRole":"10","partyRoleDescription":"Bill-To","determinationMethodCode":5,"isMain":true,"partyType":"ACCOUNT"},"shipToAccount":{"defaultExternalBusinessPartnerId":"1011051","id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","name":"0cb123e6-205c-490e-9ae6-656d1a836665","isDeleted":false,"partyRoleCategory":"SHIP_TO","partyRole":"1005","partyRoleDescription":"Ship-To","determinationMethodCode":5,"isMain":true,"partyType":"ACCOUNT"},"payerAccount":{"defaultExternalBusinessPartnerId":"1011051","id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","name":"0cb123e6-205c-490e-9ae6-656d1a836665","isDeleted":false,"partyRoleCategory":"PAYER","partyRole":"8","partyRoleDescription":"Payer","determinationMethodCode":5,"isMain":true,"partyType":"ACCOUNT"},"description":{"content":"Foo BAr","id":"ef13647b-7fce-11ee-b35c-6713de60ec71","noteId":"e9272061-7fce-11ee-9288-35027b8b36a9","noteType":"S001","adminData":{"createdOn":"2023-11-10T13:41:54.671Z","createdBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","createdByName":"USER USA","updatedOn":"2023-11-10T13:42:05.392Z","updatedBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","updatedByName":"USER USA"}},"timePoints":{"reportedOn":"2023-11-10T13:40:00Z","completionDueOn":"2023-11-14T01:00:00Z","initialReviewDueOn":"2023-11-13T21:00:00Z","resolutionDueOn":"2023-11-14T03:00:00Z","responseDueOn":"2023-11-13T23:00:00Z","assignedToProcessorOn":"2023-11-10T13:42:05.111Z"},"serviceLevelId":"91fd5e02-0682-11ee-83c8-c50b5909f3c0","serviceLevel":"check 9 june","isRecommendedCategory":false,"isEndOfPurpose":false,"isDepersonalized":false,"isRead":false,"isIrrelevant":false,"extensions":{"zTest":false,"sla_val":"blup"},"adminData":{"createdOn":"2023-11-10T13:42:04.219Z","createdBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","createdByName":"USER USA","updatedOn":"2023-11-10T13:43:13.060Z","updatedBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","updatedByName":"USER USA"}},"beforeImage":{"id":"ef1168aa-7fce-11ee-b35c-c131ed2a6ffb","displayId":"47545","subject":"float","priority":"03","origin":"MANUAL_DATA_ENTRY","caseType":"ZINC","statusSchema":"01","status":"01","escalationStatus":"NOT_ESCALATED","communicationLanguage":"lt","isRecommendedCommunicationLanguage":false,"account":{"id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","isDeleted":false,"partyRoleCategory":"ACCOUNT","partyRole":"1001","determinationMethodCode":1,"isMain":true,"partyType":"ACCOUNT"},"contact":{"id":"11ed11d5-53f5-b5ee-afdb-81b512a8c000","displayId":"1003607","isDeleted":false,"partyRoleCategory":"ACCOUNT_CONTACT","partyRole":"591","addressId":"11ed11d5-53f9-385e-afdb-81b512a8c000","determinationMethodCode":7,"isMain":true,"partyType":"CONTACT"},"processor":{"id":"11ecc541-6e89-4fbe-afdb-81e430a8c000","displayId":"8000000119","isDeleted":false,"partyRoleCategory":"PROCESSOR","partyRole":"40","addressId":"11ede9a4-544b-20ae-afdb-81f452a8c000","determinationMethodCode":3,"isMain":true,"partyType":"EMPLOYEE"},"serviceTeam":{"id":"11ec5c1e-611a-ec8e-afdb-23454c534123","displayId":"92333299","isDeleted":false,"partyRoleCategory":"SERVICE_TEAM","partyRole":"28","addressId":"11ec5c1e-611b-88ce-afdb-23454c534123","determinationMethodCode":1,"isMain":true,"partyType":"ORGANIZATIONAL_UNIT"},"reporter":{"id":"11ed11d5-53f5-b5ee-afdb-81b512a8c000","displayId":"1003607","isDeleted":false,"partyRoleCategory":"REPORTER","partyRole":"214","addressId":"11ed11d5-53f9-385e-afdb-81b512a8c000","determinationMethodCode":5,"isMain":true,"partyType":"CONTACT"},"billToAccount":{"id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","isDeleted":false,"partyRoleCategory":"BILL_TO","partyRole":"10","determinationMethodCode":5,"isMain":true,"partyType":"ACCOUNT"},"shipToAccount":{"id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","isDeleted":false,"partyRoleCategory":"SHIP_TO","partyRole":"1005","determinationMethodCode":5,"isMain":true,"partyType":"ACCOUNT"},"payerAccount":{"id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","isDeleted":false,"partyRoleCategory":"PAYER","partyRole":"8","determinationMethodCode":5,"isMain":true,"partyType":"ACCOUNT"},"description":{"id":"ef13647b-7fce-11ee-b35c-6713de60ec71","noteId":"e9272061-7fce-11ee-9288-35027b8b36a9","adminData":{"createdOn":"2023-11-10T13:41:54.671Z","createdBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","updatedOn":"2023-11-10T13:42:05.392Z","updatedBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752"}},"timePoints":{"reportedOn":"2023-11-10T13:40:00Z","completionDueOn":"2023-11-14T01:00:00Z","initialReviewDueOn":"2023-11-13T21:00:00Z","resolutionDueOn":"2023-11-14T03:00:00Z","responseDueOn":"2023-11-13T23:00:00Z","assignedToProcessorOn":"2023-11-10T13:42:05.111Z"},"serviceLevelId":"91fd5e02-0682-11ee-83c8-c50b5909f3c0","isRecommendedCategory":false,"isEndOfPurpose":false,"isDepersonalized":false,"isRead":false,"isIrrelevant":false,"extensions":{"zTest":false,"sla_val":"blup"},"adminData":{"createdOn":"2023-11-10T13:42:04.219Z","createdBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","updatedOn":"2023-11-10T13:43:13.060Z","updatedBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752"}}}
        request(app)
        .post('/case')
        .send(testRequestBody)
        .expect('Content-Type', /json/)
        .expect(200)
        .then( response => {
            expect(response.body.data.processor).to.be(undefined)
            done()
        })
    })
    it('Keeps Processor on team change', (done) => {
        var testRequestBody = {"entity":"sap.crm.caseservice.entity.case","currentImage":{"id":"ef1168aa-7fce-11ee-b35c-c131ed2a6ffb","displayId":"47545","subject":"float","priority":"03","priorityDescription":"Medium","origin":"MANUAL_DATA_ENTRY","caseType":"ZINC","caseTypeDescription":"Case Type for Account","statusSchema":"01","status":"01","statusDescription":"open up","escalationStatus":"NOT_ESCALATED","communicationLanguage":"lt","isRecommendedCommunicationLanguage":false,"processor":{"emailId":"user.usa@dummy.com","employeeDisplayId":"USERUSA1","id":"11ecc541-6e89-4fbe-afdb-81e430a8c000","displayId":"8000000119","name":"USER USA","isDeleted":false,"partyRoleCategory":"PROCESSOR","partyRole":"40","partyRoleDescription":"Processor","addressId":"11ede9a4-544b-20ae-afdb-81f452a8c000","determinationMethodCode":3,"isMain":true,"partyType":"EMPLOYEE"},"account":{"defaultExternalBusinessPartnerId":"1011051","id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","name":"0cb123e6-205c-490e-9ae6-656d1a836665","isDeleted":false,"partyRoleCategory":"ACCOUNT","partyRole":"1001","partyRoleDescription":"Account","determinationMethodCode":1,"isMain":true,"partyType":"ACCOUNT"},"contact":{"emailId":"cOrg_c6156eb0@modernized.sap.com","id":"11ed11d5-53f5-b5ee-afdb-81b512a8c000","displayId":"1003607","name":"42482196-6d3d-4a2b-94d9-d4d5031ee01d 912e6383-8ae6-49b7-94e1-0911dbe73b03","isDeleted":false,"partyRoleCategory":"ACCOUNT_CONTACT","partyRole":"591","partyRoleDescription":"Contact of Account","addressId":"11ed11d5-53f9-385e-afdb-81b512a8c000","determinationMethodCode":7,"isMain":true,"partyType":"CONTACT"},"serviceTeam":{"id":"11ecafbb-3805-a33e-afdb-810231a8c000","displayId":"SO_KM99","name":"AA: do not touch!!","isDeleted":false,"partyRoleCategory":"SERVICE_TEAM","partyRole":"28","partyRoleDescription":"Service and Support Team","addressId":"11ec5c1e-611b-88ce-afdb-23454c534123","determinationMethodCode":1,"isMain":true,"partyType":"ORGANIZATIONAL_UNIT"},"reporter":{"id":"11ed11d5-53f5-b5ee-afdb-81b512a8c000","displayId":"1003607","name":"42482196-6d3d-4a2b-94d9-d4d5031ee01d 912e6383-8ae6-49b7-94e1-0911dbe73b03","isDeleted":false,"partyRoleCategory":"REPORTER","partyRole":"214","partyRoleDescription":"Reporter","addressId":"11ed11d5-53f9-385e-afdb-81b512a8c000","determinationMethodCode":5,"isMain":true,"partyType":"CONTACT"},"billToAccount":{"defaultExternalBusinessPartnerId":"1011051","id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","name":"0cb123e6-205c-490e-9ae6-656d1a836665","isDeleted":false,"partyRoleCategory":"BILL_TO","partyRole":"10","partyRoleDescription":"Bill-To","determinationMethodCode":5,"isMain":true,"partyType":"ACCOUNT"},"shipToAccount":{"defaultExternalBusinessPartnerId":"1011051","id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","name":"0cb123e6-205c-490e-9ae6-656d1a836665","isDeleted":false,"partyRoleCategory":"SHIP_TO","partyRole":"1005","partyRoleDescription":"Ship-To","determinationMethodCode":5,"isMain":true,"partyType":"ACCOUNT"},"payerAccount":{"defaultExternalBusinessPartnerId":"1011051","id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","name":"0cb123e6-205c-490e-9ae6-656d1a836665","isDeleted":false,"partyRoleCategory":"PAYER","partyRole":"8","partyRoleDescription":"Payer","determinationMethodCode":5,"isMain":true,"partyType":"ACCOUNT"},"description":{"content":"Foo BAr","id":"ef13647b-7fce-11ee-b35c-6713de60ec71","noteId":"e9272061-7fce-11ee-9288-35027b8b36a9","noteType":"S001","adminData":{"createdOn":"2023-11-10T13:41:54.671Z","createdBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","createdByName":"USER USA","updatedOn":"2023-11-10T13:42:05.392Z","updatedBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","updatedByName":"USER USA"}},"timePoints":{"reportedOn":"2023-11-10T13:40:00Z","completionDueOn":"2023-11-14T01:00:00Z","initialReviewDueOn":"2023-11-13T21:00:00Z","resolutionDueOn":"2023-11-14T03:00:00Z","responseDueOn":"2023-11-13T23:00:00Z","assignedToProcessorOn":"2023-11-10T13:42:05.111Z"},"serviceLevelId":"91fd5e02-0682-11ee-83c8-c50b5909f3c0","serviceLevel":"check 9 june","isRecommendedCategory":false,"isEndOfPurpose":false,"isDepersonalized":false,"isRead":false,"isIrrelevant":false,"extensions":{"zTest":false,"sla_val":"blup"},"adminData":{"createdOn":"2023-11-10T13:42:04.219Z","createdBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","createdByName":"USER USA","updatedOn":"2023-11-10T13:43:13.060Z","updatedBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","updatedByName":"USER USA"}},"beforeImage":{"id":"ef1168aa-7fce-11ee-b35c-c131ed2a6ffb","displayId":"47545","subject":"float","priority":"03","priorityDescription":"Medium","origin":"MANUAL_DATA_ENTRY","caseType":"ZINC","caseTypeDescription":"Case Type for Account","statusSchema":"01","status":"01","statusDescription":"open up","escalationStatus":"NOT_ESCALATED","communicationLanguage":"lt","isRecommendedCommunicationLanguage":false,"account":{"defaultExternalBusinessPartnerId":"1011051","id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","name":"0cb123e6-205c-490e-9ae6-656d1a836665","isDeleted":false,"partyRoleCategory":"ACCOUNT","partyRole":"1001","partyRoleDescription":"Account","determinationMethodCode":1,"isMain":true,"partyType":"ACCOUNT"},"contact":{"emailId":"cOrg_c6156eb0@modernized.sap.com","id":"11ed11d5-53f5-b5ee-afdb-81b512a8c000","displayId":"1003607","name":"42482196-6d3d-4a2b-94d9-d4d5031ee01d 912e6383-8ae6-49b7-94e1-0911dbe73b03","isDeleted":false,"partyRoleCategory":"ACCOUNT_CONTACT","partyRole":"591","partyRoleDescription":"Contact of Account","addressId":"11ed11d5-53f9-385e-afdb-81b512a8c000","determinationMethodCode":7,"isMain":true,"partyType":"CONTACT"},"processor":{"emailId":"user.usa@dummy.com","employeeDisplayId":"USERUSA1","id":"11ecc541-6e89-4fbe-afdb-81e430a8c000","displayId":"8000000119","name":"USER USA","isDeleted":false,"partyRoleCategory":"PROCESSOR","partyRole":"40","partyRoleDescription":"Processor","addressId":"11ede9a4-544b-20ae-afdb-81f452a8c000","determinationMethodCode":3,"isMain":true,"partyType":"EMPLOYEE"},"serviceTeam":{"id":"11ecafbb-3805-a33e-afdb-810231a8c000","displayId":"SO_KM99","name":"AA: do not touch!!","isDeleted":false,"partyRoleCategory":"SERVICE_TEAM","partyRole":"28","partyRoleDescription":"Service and Support Team","addressId":"11ec5c1e-611b-88ce-afdb-23454c534123","determinationMethodCode":1,"isMain":true,"partyType":"ORGANIZATIONAL_UNIT"},"reporter":{"id":"11ed11d5-53f5-b5ee-afdb-81b512a8c000","displayId":"1003607","name":"42482196-6d3d-4a2b-94d9-d4d5031ee01d 912e6383-8ae6-49b7-94e1-0911dbe73b03","isDeleted":false,"partyRoleCategory":"REPORTER","partyRole":"214","partyRoleDescription":"Reporter","addressId":"11ed11d5-53f9-385e-afdb-81b512a8c000","determinationMethodCode":5,"isMain":true,"partyType":"CONTACT"},"billToAccount":{"defaultExternalBusinessPartnerId":"1011051","id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","name":"0cb123e6-205c-490e-9ae6-656d1a836665","isDeleted":false,"partyRoleCategory":"BILL_TO","partyRole":"10","partyRoleDescription":"Bill-To","determinationMethodCode":5,"isMain":true,"partyType":"ACCOUNT"},"shipToAccount":{"defaultExternalBusinessPartnerId":"1011051","id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","name":"0cb123e6-205c-490e-9ae6-656d1a836665","isDeleted":false,"partyRoleCategory":"SHIP_TO","partyRole":"1005","partyRoleDescription":"Ship-To","determinationMethodCode":5,"isMain":true,"partyType":"ACCOUNT"},"payerAccount":{"defaultExternalBusinessPartnerId":"1011051","id":"11ed11d5-518f-644e-afdb-81b512a8c000","displayId":"1003625","name":"0cb123e6-205c-490e-9ae6-656d1a836665","isDeleted":false,"partyRoleCategory":"PAYER","partyRole":"8","partyRoleDescription":"Payer","determinationMethodCode":5,"isMain":true,"partyType":"ACCOUNT"},"description":{"content":"Foo BAr","id":"ef13647b-7fce-11ee-b35c-6713de60ec71","noteId":"e9272061-7fce-11ee-9288-35027b8b36a9","noteType":"S001","adminData":{"createdOn":"2023-11-10T13:41:54.671Z","createdBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","createdByName":"USER USA","updatedOn":"2023-11-10T13:42:05.392Z","updatedBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","updatedByName":"USER USA"}},"timePoints":{"reportedOn":"2023-11-10T13:40:00Z","completionDueOn":"2023-11-14T01:00:00Z","initialReviewDueOn":"2023-11-13T21:00:00Z","resolutionDueOn":"2023-11-14T03:00:00Z","responseDueOn":"2023-11-13T23:00:00Z","assignedToProcessorOn":"2023-11-10T13:42:05.111Z"},"serviceLevelId":"91fd5e02-0682-11ee-83c8-c50b5909f3c0","serviceLevel":"check 9 june","isRecommendedCategory":false,"isEndOfPurpose":false,"isDepersonalized":false,"isRead":false,"isIrrelevant":false,"extensions":{"zTest":false,"sla_val":"blup"},"adminData":{"createdOn":"2023-11-10T13:42:04.219Z","createdBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","createdByName":"USER USA","updatedOn":"2023-11-10T13:43:13.060Z","updatedBy":"abf4a353-ea15-11e9-8fa7-f92a516fe752","updatedByName":"USER USA"}}}
        request(app)
        .post('/case')
        .send(testRequestBody)
        .expect('Content-Type', /json/)
        .expect(200)
        .then( response => {
            expect(response.body.data.processor.id).to.be('11ecc541-6e89-4fbe-afdb-81e430a8c000')
            done()
        })
    })
})